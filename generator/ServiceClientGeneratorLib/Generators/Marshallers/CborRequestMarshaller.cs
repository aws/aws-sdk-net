// ------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version: 17.0.0.0
//  
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
// ------------------------------------------------------------------------------
namespace ServiceClientGenerator.Generators.Marshallers
{
    using System.Linq;
    using System.Text;
    using System.Collections.Generic;
    using System;
    
    /// <summary>
    /// Class to produce the template output
    /// </summary>
    
    #line 1 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"
    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("Microsoft.VisualStudio.TextTemplating", "17.0.0.0")]
    public partial class CborRequestMarshaller : CborStructureMarshaller
    {
#line hidden
        /// <summary>
        /// Create the template output
        /// </summary>
        public override string TransformText()
        {
            
            #line 6 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"

	AddLicenseHeader();

	AddCommonUsingStatements();

            
            #line default
            #line hidden
            this.Write("using Amazon.Extensions.CborProtocol;\r\nusing Amazon.Extensions.CborProtocol.Inter" +
                    "nal;\r\nusing Amazon.Extensions.CborProtocol.Internal.Transform;\r\n\r\n#pragma warnin" +
                    "g disable CS0612,CS0618\r\nnamespace ");
            
            #line 16 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Config.Namespace));
            
            #line default
            #line hidden
            this.Write(".Model.Internal.MarshallTransformations\r\n{\r\n\t/// <summary>\r\n\t/// ");
            
            #line 19 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Operation.Name));
            
            #line default
            #line hidden
            this.Write(" Request Marshaller\r\n\t/// </summary>       \r\n\tpublic class ");
            
            #line 21 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Operation.Name));
            
            #line default
            #line hidden
            this.Write("RequestMarshaller : IMarshaller<IRequest, ");
            
            #line 21 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Operation.Name));
            
            #line default
            #line hidden
            this.Write(@"Request> , IMarshaller<IRequest,AmazonWebServiceRequest>
	{
        /// <summary>
        /// Marshaller the request object to the HTTP request.
        /// </summary>  
        /// <param name=""input""></param>
        /// <returns></returns>
		public IRequest Marshall(AmazonWebServiceRequest input)
        {
            return this.Marshall((");
            
            #line 30 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Operation.Name));
            
            #line default
            #line hidden
            this.Write("Request)input);\r\n        }\r\n\r\n        /// <summary>\r\n        /// Marshaller the r" +
                    "equest object to the HTTP request.\r\n        /// </summary>  \r\n        /// <param" +
                    " name=\"publicRequest\"></param>\r\n        /// <returns></returns>\r\n\t\tpublic IReque" +
                    "st Marshall(");
            
            #line 38 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Operation.Name));
            
            #line default
            #line hidden
            this.Write("Request publicRequest)\r\n\t\t{\r\n\t\t\tIRequest request = new DefaultRequest(publicReque" +
                    "st, \"");
            
            #line 40 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Config.Namespace));
            
            #line default
            #line hidden
            this.Write("\");\r\n            request.Headers[\"smithy-protocol\"] = \"rpc-v2-cbor\";\r\n");
            
            #line 42 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"

			if (string.IsNullOrEmpty(this.Config.ServiceModel.TargetPrefix))
			{
				throw new System.InvalidOperationException("TargetPrefix is required for CBOR based services.");
			}

            
            #line default
            #line hidden
            this.Write("\t\t\trequest.ResourcePath = \"");
            
            #line 48 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture($"service/{this.Config.ServiceModel.TargetPrefix}/operation/{this.Operation.Name}"));
            
            #line default
            #line hidden
            this.Write("\";\r\n");
            
            #line 49 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"

	if ((this.Config.ServiceModel.H2Support == H2SupportDegree.Optional && this.Operation.IsEventStreamBidi) || (this.Config.ServiceModel.H2Support == H2SupportDegree.EventStream && this.Operation.IsEventStreamOutput) || this.Config.ServiceModel.H2Support == H2SupportDegree.Required)
	{

            
            #line default
            #line hidden
            this.Write("#if NET8_0_OR_GREATER\r\n            request.HttpProtocolVersion = System.Net.HttpV" +
                    "ersion.Version20;\r\n#endif\r\n");
            
            #line 56 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"

	}

	if (this.Config.ServiceModel.IsAwsQueryCompatible)
	{

            
            #line default
            #line hidden
            this.Write("\t\t\trequest.Headers[Amazon.Util.HeaderKeys.XAmzQueryMode] = \"true\";\r\n");
            
            #line 63 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"

	}

	var requestStructure = this.Operation.RequestStructure;

	if (this.Operation.IsEventStreamInput)
	{
		var eventStreamMember = this.Operation.RequestEventStreamingMember;

            
            #line default
            #line hidden
            this.Write("            request.Headers[\"Content-Type\"] = \"application/vnd.amazon.eventstream" +
                    "\";\r\n            request.EventStreamPublisher = new ");
            
            #line 73 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(eventStreamMember.Shape.Name));
            
            #line default
            #line hidden
            this.Write("PublisherMarshaller(publicRequest.");
            
            #line 73 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(eventStreamMember.PropertyName));
            
            #line default
            #line hidden
            this.Write(");\r\n");
            
            #line 74 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"

	}
	else if (requestStructure != null)
	{

            
            #line default
            #line hidden
            this.Write("\t\t\trequest.Headers[\"Content-Type\"] = \"application/cbor\";\r\n");
            
            #line 80 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"
	
	}

	if (this.Operation.IsEventStreamOutput)
	{

            
            #line default
            #line hidden
            this.Write("\t\t\trequest.Headers[\"Accept\"] = \"application/vnd.amazon.eventstream\";\r\n");
            
            #line 87 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"

	}
	else
	{

            
            #line default
            #line hidden
            this.Write("\t\t\trequest.Headers[\"Accept\"] = \"application/cbor\";\r\n");
            
            #line 93 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"
	
	}

	SetCompressionAlgorithmEncoding(this.Operation);

	var payload = this.Operation.RequestPayloadMember;

            
            #line default
            #line hidden
            this.Write("            request.Headers[Amazon.Util.HeaderKeys.XAmzApiVersion] = \"");
            
            #line 100 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Config.ServiceModel.APIVersion));
            
            #line default
            #line hidden
            this.Write("\";\r\n            request.HttpMethod = \"POST\";\r\n\r\n");
            
            #line 103 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"

    // Generates code to add members of the request to the request being created by the marshaller
	ProcessRequestUri(this.Operation);

    var shouldMarshallPayload = (payload != null && !payload.Shape.IsEventStream);
	// Process any members which are marshalled as part of the request body
	if (requestStructure != null)
	{

            
            #line default
            #line hidden
            this.Write("            var writer = CborWriterPool.Rent();\r\n            try\r\n            {\r\n" +
                    "");
            
            #line 115 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"
		
		if (payload?.Shape.IsString == true) 
		{

            
            #line default
            #line hidden
            this.Write("\t\t\t\twriter.WriteTextString(publicRequest.");
            
            #line 119 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(payload.PropertyName));
            
            #line default
            #line hidden
            this.Write(");\r\n");
            
            #line 120 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"
		
		}
		else if (shouldMarshallPayload)
		{

            
            #line default
            #line hidden
            this.Write("\t\t\t\tvar context = new CborMarshallerContext(request, writer);\r\n\r\n");
            
            #line 127 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"
		
				ProcessStructure(1, "publicRequest." + payload.PropertyName, payload.Shape);
		}
		else
		{

            
            #line default
            #line hidden
            this.Write("\t\t\t\twriter.WriteStartMap(null);\r\n\t\t\t\tvar context = new CborMarshallerContext(requ" +
                    "est, writer);\r\n");
            
            #line 135 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"
		
				ProcessMembers(1, "publicRequest", this.Operation.RequestBodyMembers);

            
            #line default
            #line hidden
            this.Write("\t\t\t\twriter.WriteEndMap();\r\n");
            
            #line 139 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"

		}

            
            #line default
            #line hidden
            this.Write("\t\t\t\trequest.Content = writer.Encode();\r\n\t\t\t}\r\n            finally\r\n            {\r" +
                    "\n                CborWriterPool.Return(writer);\r\n            }\r\n");
            
            #line 148 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"

			GenerateRequestChecksumHandling(this.Operation, "snippet");

            
            #line default
            #line hidden
            this.Write("\t\t\t\r\n");
            
            #line 151 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"

	}

	if (this.Operation.UnsignedPayload)
	{

            
            #line default
            #line hidden
            this.Write("\t\t\trequest.DisablePayloadSigning = true;\r\n");
            
            #line 158 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"
	}

	if (!string.IsNullOrEmpty(this.Operation.EndpointHostPrefix))
	{
		ProcessEndpointHostPrefixMembers(3, "publicRequest", this.Operation);
	}

            
            #line default
            #line hidden
            this.Write("\t\t\treturn request;\r\n\t\t}\r\n");
            
            #line 167 "C:\Dev\Repos\aws-sdk-net-staging\generator\ServiceClientGeneratorLib\Generators\Marshallers\CborRequestMarshaller.tt"
				
		this.AddRequestSingletonMethod();

            
            #line default
            #line hidden
            this.Write("\t}\r\n}");
            return this.GenerationEnvironment.ToString();
        }
    }
    
    #line default
    #line hidden
}
